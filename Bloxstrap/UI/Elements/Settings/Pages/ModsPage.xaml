<ui:UiPage
    x:Class="Bloxstrap.UI.Elements.Settings.Pages.ModsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:models="clr-namespace:Bloxstrap.Models"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:dmodels="clr-namespace:Bloxstrap.UI.ViewModels.Settings"
    Title="ModsPage" 
    Scrollable="True" 
    AllowDrop="True" 
    Drop="Page_Drop"
    mc:Ignorable="d"
    d:DataContext="{d:DesignInstance dmodels:ModsViewModel}">

    <StackPanel Margin="0,0,14,14">
        <TextBlock
            FontSize="14"
            Foreground="{StaticResource TextFillColorSecondaryBrush}"
            Text="Manage your mods and their application order. Mods at the bottom have higher priority and will overwrite mods above them."
            TextWrapping="Wrap" 
            Margin="0,0,0,16"/>

        <ui:InfoBar Severity="Informational" Message="You can drag and drop your mod to auto add it here" />

        <ui:Button Margin="0,8"
           Icon="Add24"
           Content="Add new mod"
           HorizontalAlignment="Stretch"
           Appearance="Secondary"
           Command="{Binding AddModCommand}" />

        <ItemsControl ItemsSource="{Binding Modifications, Mode=OneWay}">
            <ItemsControl.ItemTemplate>
                <DataTemplate DataType="{x:Type models:ModConfig}">
                    <ui:Card Margin="0,0,0,8" >
                        <Grid Margin="0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <ui:Button Grid.Column="0" 
                                       Icon="Delete24" 
                                       Appearance="Danger"
                                       Command="{Binding DataContext.DeleteModCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                       CommandParameter="{Binding}" />

                            <ui:TextBox Grid.Column="1" Width="300"
                                        Text="{Binding FolderName, Mode=TwoWay, UpdateSourceTrigger=LostFocus}" 
                                        PlaceholderText="Mod Name"
                                        Margin="8,0" 
                                        GotFocus="ModName_GotFocus"
                                        LostFocus="ModName_LostFocus" />

                            <ComboBox Grid.Column="3" Margin="0,0,8,0"
                                      SelectedValue="{Binding Target, Mode=TwoWay}" 
                                      SelectedValuePath="Content"
                                      Width="150">
                                <ComboBoxItem Content="Both" />
                                <ComboBoxItem Content="Player" />
                                <ComboBoxItem Content="Studio" />
                                <ComboBoxItem Content="Disabled" />
                            </ComboBox>

                            <ui:Button Grid.Column="4" 
                                       Icon="Folder24" 
                                       Command="{Binding DataContext.OpenModFolderCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                       CommandParameter="{Binding}" />

                            <ui:Button Grid.Column="5" Margin="4,0,0,0"
                                       Icon="ArrowUp24" 
                                       Command="{Binding DataContext.MoveUpCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                       CommandParameter="{Binding}" />

                            <ui:Button Grid.Column="6" Margin="4,0,0,0"
                                       Icon="ArrowDown24" 
                                       Command="{Binding DataContext.MoveDownCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                       CommandParameter="{Binding}" />
                        </Grid>
                    </ui:Card>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>
    </StackPanel>
</ui:UiPage>