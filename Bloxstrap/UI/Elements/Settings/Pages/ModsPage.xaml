<ui:UiPage
    x:Class="Bloxstrap.UI.Elements.Settings.Pages.ModsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:models="clr-namespace:Bloxstrap.Models"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:dmodels="clr-namespace:Bloxstrap.UI.ViewModels.Settings"
    xmlns:vmodels="clr-namespace:Bloxstrap.UI.ViewModels"
    xmlns:controls="clr-namespace:Bloxstrap.UI.Elements.Controls"
    xmlns:resources="clr-namespace:Bloxstrap.Resources"
    Title="ModsPage" 
    Scrollable="True" 
    AllowDrop="True" 
    Drop="Page_Drop"
    mc:Ignorable="d"
    d:DataContext="{d:DesignInstance dmodels:ModsViewModel}">

    <StackPanel Margin="0,0,14,14">
        <TextBlock
            FontSize="14"
            Foreground="{StaticResource TextFillColorSecondaryBrush}"
            Text="Manage your mods and their application order. Mods at the bottom have higher priority and will overwrite mods above them."
            TextWrapping="Wrap" />

        <Grid Margin="0,16,0,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <ui:CardAction Grid.Row="0" Grid.Column="0" Margin="0,0,4,0" Command="{Binding OpenCommunityModsCommand}" Icon="BuildingShop20">
                <StackPanel>
                    <TextBlock FontSize="14" Text="Community Mods" />
                    <TextBlock  Margin="0,2,0,0" Padding="0,0,16,0" FontSize="12" Foreground="{StaticResource TextFillColorTertiaryBrush}" Text="Download mods made by other people." TextWrapping="Wrap" />
                </StackPanel>
            </ui:CardAction>

            <ui:CardAction Grid.Row="0" Grid.Column="1" Margin="4,0,0,0" Command="{Binding OpenPresetModsCommand}" Icon="ReadingModeMobile24">
                <StackPanel>
                    <TextBlock FontSize="14" Text="Preset Mods" TextWrapping="Wrap" />
                    <TextBlock Margin="0,2,0,0" FontSize="12" Foreground="{DynamicResource TextFillColorTertiaryBrush}" Text="Use our built-in mods." TextWrapping="Wrap" />
                </StackPanel>
            </ui:CardAction>

            <ui:CardAction Grid.Row="1" Grid.ColumnSpan="2" Margin="0,7,0,0" VerticalAlignment="Top" Command="{Binding OpenModGeneratorCommand}" Icon="Color20">
                <StackPanel>
                    <TextBlock FontSize="14" Text="Mod Generator" TextWrapping="Wrap" />
                    <controls:MarkdownTextBlock Margin="0,2,0,0" FontSize="12"  Foreground="{StaticResource TextFillColorTertiaryBrush}" MarkdownText="Generate mods easily with a single click by using a hex code color." TextWrapping="Wrap" />
                </StackPanel>
            </ui:CardAction>
        </Grid>

        <Separator Margin="0,8" />

        <ui:InfoBar Severity="Informational" Message="You can drag and drop your mod to auto add it here" Padding="8" IsOpen="True" Title="Important" IsClosable="False" Background="{DynamicResource PrimaryBackgroundColor}" />

        <ui:Button Margin="0,8,0,8"
           Icon="Add24"
           Content="Add new mod"
           HorizontalAlignment="Stretch"
           Appearance="Secondary"
           Command="{Binding AddModCommand}" />

        <ItemsControl ItemsSource="{Binding Modifications, Mode=OneWay}">
            <ItemsControl.ItemTemplate>
                <DataTemplate DataType="{x:Type models:ModConfig}">
                    <ui:Card Margin="0,0,0,8" >
                        <Grid Margin="0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <ui:Button Grid.Column="0" 
                                       Icon="Delete24" 
                                       Appearance="Danger"
                                       Command="{Binding DataContext.DeleteModCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                       CommandParameter="{Binding}" />

                            <ui:TextBox Grid.Column="1" Width="300"
                                        Text="{Binding FolderName, Mode=TwoWay, UpdateSourceTrigger=LostFocus}" 
                                        PlaceholderText="Mod Name"
                                        Margin="8,0" 
                                        GotFocus="ModName_GotFocus"
                                        LostFocus="ModName_LostFocus" />

                            <ComboBox Grid.Column="3" Margin="0,0,8,0"
                                      SelectedValue="{Binding Target, Mode=TwoWay}" 
                                      SelectedValuePath="Content"
                                      Width="150">
                                <ComboBoxItem Content="Both" />
                                <ComboBoxItem Content="Player" />
                                <ComboBoxItem Content="Studio" />
                                <ComboBoxItem Content="Disabled" />
                            </ComboBox>

                            <ui:Button Grid.Column="4" 
                                       Icon="Folder24" 
                                       Command="{Binding DataContext.OpenModFolderCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                       CommandParameter="{Binding}" />

                            <ui:Button Grid.Column="5" Margin="4,0,0,0"
                                       Icon="ArrowUp24" 
                                       Command="{Binding DataContext.MoveUpCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                       CommandParameter="{Binding}" />

                            <ui:Button Grid.Column="6" Margin="4,0,0,0"
                                       Icon="ArrowDown24" 
                                       Command="{Binding DataContext.MoveDownCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                       CommandParameter="{Binding}" />
                        </Grid>
                    </ui:Card>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>
    </StackPanel>
</ui:UiPage>